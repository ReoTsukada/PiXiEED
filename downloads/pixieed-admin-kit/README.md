# PiXiEED 管理者向けメモ

## 1. スポンサーから受け取るもの
- Zip 形式のフォルダ。中身は以下のようになっています。
  ```
  sponsor-name/
    README.txt
    submission.txt
    ogp.txt
    任意の画像ファイル (必要な場合のみ)
  ```
- `ogp.txt` の `url=` に広告ページが必ず記入されています。必要に応じて `title` / `description` / `image` などが上書きされています。
- 任意で画像ファイルが同梱されている場合、そのファイル名を `image=` に指定してもらっていれば優先して使用します。

## 2. 反映手順
1. 受け取った Zip を解凍し、フォルダごと `ads/adsets/vendors/` に配置します。
   - 例: `ads/adsets/vendors/sponsor-name/`
   - フォルダ名が衝突した場合は `sponsor-name-yyyymmdd` などにリネームしてください。
2. 反映方法
   - **自動**: `node tools/ads/watch.mjs` を起動すると、フォルダ追加時に自動で `ads/adsets/active/config.json` が再生成されます。
   - **手動**: 1回だけ反映したい場合は `node tools/ads/apply.mjs` を実行します。
3. 反映後、`index.html` をブラウザで開き、ヒーロー／ショーケース／ページ下部に意図した広告が表示されるか確認してください。

## 3. ドットギャラリーの更新
- `portfolio/dots/` に PNG / JPG / GIF / WebP の作品を追加し、以下のコマンドを実行するとギャラリー用の `manifest.json` が再生成されます。

  
  `node tools/gallery/build.mjs`

- コマンド実行後に `portfolio/index.html` を再読み込みすると、追加した作品がビュアーに表示されます。

## 4. 仕組み
- `apply.mjs` は各スポンサーの `ogp.txt` を読み取り、`url` から OGP 情報（タイトル／説明／画像／サイト名）を取得します。
- `ogp.txt` で `title` や `description` を入力している場合はその内容で上書きします。
- `image=` を空欄にしていても、OGP画像が取得できれば自動で使用します。取得できない場合は、同フォルダ内の画像ファイルを探して利用します。
- ヒーロー枠とショーケース枠では画像が必須です。OGP画像もローカル画像も見つからない場合、そのスポンサーの該当枠はスキップされます。
- ページ下部バナー枠は画像がなくてもテキストのみで表示されます。`label` が空の場合はサイト名やURLから自動補完します。

## 5. 表示優先度
- `ogp.txt` の `priority` に数値を設定すると表示順を制御できます（小さいほど優先）。
- ヒーロー枠 : 最大3件
- ショーケース枠 : 最優先の1件
- フッター枠 : 最大3件

## 6. トラブルシューティング
- **OGP取得に失敗する** → ネットワーク接続を確認し、再度 `node tools/ads/apply.mjs` を実行してください。スポンサーに `image=` で直接画像URLまたはファイル名を指定してもらうのも有効です。
- **広告が表示されない** → `ogp.txt` の `url` が入力されているか確認し、必要なら `priority` を調整してください。
- **自動反映が行われない** → `watch.mjs` が起動しているか確認し、停止している場合は再起動してください。

## 7. 動作要件
- Node.js 18 以上（`fetch` API を使用）。
- OGP 取得にはインターネット接続が必要です。大量のスポンサーを処理する場合は時間に余裕を持って実行してください。

以上で管理者側の作業は完了です。
