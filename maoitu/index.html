<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>魔王様！！いつまでよければいいですか！？</title>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SZPVXMX85G"></script>
<script>
const GA_MEASUREMENT_ID = 'G-SZPVXMX85G';
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', GA_MEASUREMENT_ID);
</script>
<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9801602250480253" crossorigin="anonymous"></script>

<!-- ▼ OGP / Twitterカード -->
<meta property="og:title" content="魔王様！！いつまでよければいいですか！？">
<meta property="og:description" content="避けゲーアクション！皆もやってみてね！">
<meta property="og:type" content="website">
<meta property="og:url" content="https://pixieed.jp/maoitu/">
<meta property="og:image" content="https://pixieed.jp/maoitu/ogp.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@PiXiEED_arta">
<link rel="icon" type="image/png" sizes="192x192" href="/maoitu/icons/icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/maoitu/icons/icon-512.png">
<link rel="apple-touch-icon" href="/maoitu/icons/icon-192.png">
<link rel="manifest" href="/maoitu/manifest.webmanifest">
<meta name="theme-color" content="#000000">
<style>
html,body {
  height:100%;
  overflow:hidden;
}
body {
  margin:0;
  height:100dvh;
  min-height:100vh;
  background:#000;
  display:flex;
  flex-direction:column;
  align-items:center;
  color:#fff;
  font-family:'Noto Sans JP', system-ui, sans-serif;
  text-align:center;
  box-sizing:border-box;
  padding:48px 16px calc(16px + env(safe-area-inset-bottom, 0px));
  gap:12px;
  overflow:hidden;
}
h1 { font-size:22px; margin:32px 0 8px; }
button {
  font:700 16px system-ui;
  padding:10px 20px;
  border:0;
  border-radius:12px;
  cursor:pointer;
}
a { color:#7dd3fc; }
.control-bar {
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:center;
  gap:16px;
}
.control-bar__btn {
  font:700 16px system-ui;
  padding:12px 24px;
  border-radius:12px;
  border:0;
  cursor:pointer;
  transition:transform 0.15s ease, filter 0.15s ease;
}
.control-bar__btn:hover,
.control-bar__btn:focus-visible {
  transform:translateY(-1px);
  filter:brightness(1.05);
  outline:none;
}
.control-bar__btn--primary {
  background:#22c55e;
  color:#000;
  font-size:18px;
}
.control-bar__btn--secondary {
  background:rgba(255,255,255,0.12);
  color:#fff;
  border:1px solid rgba(255,255,255,0.25);
}
.control-bar__audio {
  display:flex;
  align-items:center;
  gap:8px;
}
.instructions-card {
  max-width:320px;
  padding:16px 20px;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.15);
  border-radius:16px;
  color:#f3f4f6;
  font-size:14px;
  line-height:1.6;
  text-align:left;
}
.start-content {
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:20px;
  width:100%;
  max-width:360px;
  min-height:0;
  overflow:auto;
  padding-bottom:8px;
}
.start-bottom-ad {
  width:100%;
  max-width:320px;
  margin:0 auto;
  flex-shrink:0;
  margin-top:auto;
}
.start-bottom-ad .adsbygoogle {
  display:block;
  width:100%;
  height:auto;
  min-height:250px;
}
.instructions-card h2 {
  margin:0 0 8px;
  font-size:16px;
  color:#fff;
}
.instructions-card ul {
  margin:0;
  padding-left:18px;
}
.instructions-card li {
  margin-bottom:6px;
}
.switch {
  position:relative;
  display:inline-block;
  width:48px;
  height:26px;
}
.switch input { opacity:0; width:0; height:0; }
.slider {
  position:absolute;
  inset:0;
  background:#4b5563;
  border-radius:20px;
  transition:0.2s;
}
.slider:before {
  content:"";
  position:absolute;
  height:20px;
  width:20px;
  left:3px;
  top:3px;
  background:#fff;
  border-radius:50%;
  transition:0.2s;
}
.switch input:checked + .slider { background:#22c55e; }
.switch input:checked + .slider:before { transform:translateX(22px); }
.volume-label {
  font-size:14px;
  color:#ccc;
}
.back-link {
  position:absolute;
  top:16px;
  left:16px;
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.35);
  background:rgba(0,0,0,0.65);
  color:#fff;
  font:600 13px/1.2 system-ui;
  text-decoration:none;
  transition:background 0.2s ease,color 0.2s ease,transform 0.2s ease;
}
.back-link:hover,
.back-link:focus-visible {
  background:#fff;
  color:#000;
  transform:translateY(-1px);
  outline:none;
}
.install-btn {
  background:#facc15;
  color:#000;
  padding:12px 24px;
  border-radius:12px;
  font:700 16px system-ui;
  border:0;
  cursor:pointer;
  min-height:48px;
  visibility:hidden;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.2s ease;
}
.install-btn.is-visible {
  visibility:visible;
  opacity:1;
  pointer-events:auto;
}
.install-btn:hover,
.install-btn:focus-visible {
  filter:brightness(1.05);
  outline:none;
}
.developer-credit {
  font-size:14px;
  color:#9ca3af;
  margin:0 0 12px;
}
.developer-credit a {
  color:#1DA1F2;
  text-decoration:none;
}
.developer-credit a:hover,
.developer-credit a:focus-visible {
  text-decoration:underline;
}
.control-bar-wrapper {
  width:100%;
  max-width:360px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:16px;
  padding:0 16px;
  box-sizing:border-box;
}
</style>
</head>
<body>

<a class="back-link" href="../index.html#showcase">← ホームに戻る</a>

<h1>魔王様！！いつまでよければいいですか！？</h1>
<p class="developer-credit">開発者: <a href="https://x.com/PiXiEED_arta" target="_blank" rel="noopener">@PiXiEED_arta</a></p>
<div class="start-content">
  <div class="instructions-card">
    <h2>遊び方</h2>
    <ul>
      <li>操作：画面をタップ / マウスドラッグ、または ←→ キーで移動します。</li>
      <li>敵にぶつかると即ゲームオーバーです。</li>
      <li>エンジェリンを取ると一度だけ身代わりが発動し、次の衝突を防ぎます。</li>
    </ul>
  </div>

  <div class="control-bar-wrapper" role="region" aria-label="ゲーム操作">
    <div class="control-bar">
      <button id="playBtn" class="control-bar__btn control-bar__btn--primary">▶ プレイ</button>
      <button id="titleShareBtn" class="control-bar__btn control-bar__btn--secondary">シェアする</button>
      <div class="control-bar__audio">
        <label class="switch">
          <input type="checkbox" id="audioToggle">
          <span class="slider"></span>
        </label>
        <span id="audioToggleLabel" class="volume-label"></span>
      </div>
    </div>
    <button id="installBtn" class="install-btn">アプリをインストール</button>
  </div>
</div>

<div class="start-bottom-ad">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-9801602250480253"
       data-ad-slot="2435364404"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
</div>

<script>
const GAME_URL = './game.html';
const AUDIO_KEY = 'maoitu_audio';
const GAME_CANONICAL_URL = `${window.location.origin}/maoitu/`;
const playBtn = document.getElementById('playBtn');
const shareBtn = document.getElementById('titleShareBtn');
const audioToggle = document.getElementById('audioToggle');
const audioToggleLabel = document.getElementById('audioToggleLabel');
const installBtn = document.getElementById('installBtn');
const startAdSlot = document.querySelector('.start-bottom-ad .adsbygoogle');
let deferredInstallPrompt = null;

function baseShareText(){
  return `開発者:@PiXiEED_arta\n『魔王様！！いつまでよければいいですか！？』\n皆もやってみてね！！！\n\nリンクから遊べるよ！！#PiXiEED\n\n${GAME_CANONICAL_URL}`;
}

shareBtn.addEventListener('click', async () => {
  try{
    await navigator.clipboard.writeText(baseShareText());
    alert('シェア用テキストをコピーしました！');
  }catch(err){
    alert('クリップボードへのコピーに失敗しました。手動で共有してください。');
  }
});

playBtn.addEventListener('click', () => {
  window.location.href = GAME_URL;
});

function updateAudioLabel(){
  audioToggleLabel.textContent = audioToggle.checked ? '音量 ON' : '音量 OFF';
}

const storedAudio = localStorage.getItem(AUDIO_KEY);
audioToggle.checked = storedAudio !== 'off';
updateAudioLabel();

audioToggle.addEventListener('change', () => {
  localStorage.setItem(AUDIO_KEY, audioToggle.checked ? 'on' : 'off');
  updateAudioLabel();
});

window.addEventListener('beforeinstallprompt', (event) => {
  event.preventDefault();
  deferredInstallPrompt = event;
  installBtn.classList.add('is-visible');
});

installBtn.addEventListener('click', async () => {
  if(!deferredInstallPrompt){
    alert('ブラウザがインストールに対応していません。');
    return;
  }
  deferredInstallPrompt.prompt();
  const result = await deferredInstallPrompt.userChoice;
  if(result.outcome === 'accepted'){
    installBtn.classList.remove('is-visible');
  }
  deferredInstallPrompt = null;
});

window.addEventListener('appinstalled', () => {
  installBtn.classList.remove('is-visible');
  deferredInstallPrompt = null;
});

function initStartAd(){
  if(!startAdSlot) return;
  if(startAdSlot.offsetWidth === 0){
    setTimeout(initStartAd, 300);
    return;
  }
  try{
    (adsbygoogle = window.adsbygoogle || []).push({});
  }catch(_){
    setTimeout(initStartAd, 500);
  }
}

window.addEventListener('load', () => {
  if(startAdSlot){
    requestAnimationFrame(initStartAd);
  }
});
</script>

</body>
</html>
