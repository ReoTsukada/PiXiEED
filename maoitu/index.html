<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="まおいつ" name="apple-mobile-web-app-title"/>
<title>魔王様！！いつまでよければいいですか！？</title>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SZPVXMX85G"></script>
<script>
const GA_MEASUREMENT_ID = 'G-SZPVXMX85G';
const GA_PAGE_PATH = '/maoitu/';
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', GA_MEASUREMENT_ID, {
  page_path: GA_PAGE_PATH,
  page_title: document.title
});
</script>
<!-- Google AdSense -->
<script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9801602250480253"></script>
<!-- ▼ OGP / Twitterカード -->
<meta content="魔王様！！いつまでよければいいですか！？" property="og:title"/>
<meta content="避けゲーアクション！皆もやってみてね！" property="og:description"/>
<meta content="website" property="og:type"/>
<meta content="https://pixieed.jp/maoitu/" property="og:url"/>
<meta content="https://pixieed.jp/maoitu/ogp.png" property="og:image"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@PiXiEED_arta" name="twitter:site"/>
<meta content="魔王様！！いつまでよければいいですか！？" name="twitter:title"/>
<meta content="避けゲーアクション！皆もやってみてね！" name="twitter:description"/>
<meta content="https://pixieed.jp/maoitu/ogp.png" name="twitter:image"/>



<meta content="#000000" name="theme-color"/>
<style>
html,body {
  height:100%;
  overflow:hidden;
}
body {
  margin:0;
  height:100dvh;
  min-height:100vh;
  background:#000;
  display:flex;
  flex-direction:column;
  align-items:center;
  color:#fff;
  font-family:'Noto Sans JP', system-ui, sans-serif;
  text-align:center;
  box-sizing:border-box;
  padding:48px 16px calc(56px + env(safe-area-inset-bottom, 0px));
  gap:12px;
  overflow:hidden;
  --kago-icon: url('assets/kago.png');
}
h1 { font-size:22px; margin:32px 0 8px; }
button {
  font:700 16px system-ui;
  padding:10px 20px;
  border:0;
  border-radius:12px;
  cursor:pointer;
}
a { color:#7dd3fc; }
.control-bar {
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:center;
  gap:16px;
}
.control-bar__btn {
  font:700 16px system-ui;
  padding:12px 24px;
  border-radius:12px;
  border:0;
  cursor:pointer;
  transition:transform 0.15s ease, filter 0.15s ease;
}
.control-bar__btn:hover,
.control-bar__btn:focus-visible {
  transform:translateY(-1px);
  filter:brightness(1.05);
  outline:none;
}
.control-bar__btn--primary {
  background:#22c55e;
  color:#000;
  font-size:18px;
}
.control-bar__btn--secondary {
  background:rgba(255,255,255,0.12);
  color:#fff;
  border:1px solid rgba(255,255,255,0.25);
}
.control-bar__audio {
  display:flex;
  align-items:center;
  gap:8px;
}
.difficulty-toggle{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:center;
}
.difficulty-btn{
  font:900 15px system-ui;
  padding:12px 16px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.25);
  background:rgba(255,255,255,0.08);
  color:#fff;
  cursor:pointer;
  transition:transform 0.15s ease, filter 0.15s ease, border-color 0.15s ease, background 0.15s ease, color 0.15s ease;
}
.difficulty-btn:hover,
.difficulty-btn:focus-visible{
  transform:translateY(-1px);
  filter:brightness(1.05);
  outline:none;
}
.difficulty-btn.is-active[data-mode="easy"]{
  border-color:rgba(56,189,248,0.7);
  background:rgba(56,189,248,0.18);
  color:#bae6fd;
}
.difficulty-btn.is-active[data-mode="normal"]{
  border-color:rgba(34,197,94,0.7);
  background:rgba(34,197,94,0.18);
  color:#bbf7d0;
}
.difficulty-btn.is-active[data-mode="endless"]{
  border-color:rgba(249,115,22,0.7);
  background:rgba(249,115,22,0.18);
  color:#fed7aa;
}
.instructions-card {
  max-width:320px;
  padding:16px 20px;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.15);
  border-radius:16px;
  color:#f3f4f6;
  font-size:14px;
  line-height:1.6;
  text-align:left;
}
.start-content {
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:20px;
  width:100%;
  max-width:360px;
  min-height:0;
  overflow:auto;
  padding-bottom:8px;
}
.instructions-card h2 {
  margin:0 0 8px;
  font-size:16px;
  color:#fff;
}
.instructions-card ul {
  margin:0;
  padding-left:18px;
}
.instructions-card li {
  margin-bottom:6px;
}
.rank-form {
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-top:12px;
}
.rank-field {
  display:flex;
  flex-direction:column;
  gap:4px;
}
.rank-field input {
  padding:10px 12px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.25);
  background:rgba(0,0,0,0.4);
  color:#fff;
  font-size:14px;
}
.rank-name-display{
  padding:10px 12px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.25);
  background:rgba(0,0,0,0.4);
  color:#fff;
  font-size:14px;
}
.rank-list {
  list-style:none;
  padding:0;
  margin:12px 0 0;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.rank-item {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px 12px;
  border:1px solid rgba(255,255,255,0.18);
  border-radius:12px;
  background:linear-gradient(135deg, rgba(30,41,59,0.85), rgba(15,23,42,0.85));
  box-shadow:0 6px 18px rgba(0,0,0,0.3);
  font-size:14px;
}
.rank-item[data-rank="1"] { border-color:rgba(248,113,113,0.65); box-shadow:0 0 16px rgba(248,113,113,0.35); }
.rank-item[data-rank="2"] { border-color:rgba(125,211,252,0.55); box-shadow:0 0 14px rgba(125,211,252,0.25); }
.rank-item[data-rank="3"] { border-color:rgba(190,242,100,0.55); box-shadow:0 0 12px rgba(190,242,100,0.22); }
.rank-left{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.rank-index {
  color:#9ca3af;
  font-weight:700;
  min-width:28px;
}
.rank-medal{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:24px;
  height:24px;
  border-radius:8px;
  background:rgba(255,255,255,0.08);
  color:#fff;
  font-size:13px;
  letter-spacing:0.02em;
}
.rank-medal--1{ background:rgba(248,113,113,0.28); }
.rank-medal--2{ background:rgba(125,211,252,0.24); }
.rank-medal--3{ background:rgba(190,242,100,0.24); }
.rank-name {
  flex:1;
  text-align:left;
  color:#e5e7eb;
  font-weight:600;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.rank-score {
  font-weight:800;
  color:#fbbf24;
  letter-spacing:0.03em;
}
.rank-status { color:#cbd5e1; font-size:13px; min-height:18px; }
.ranking-modal {
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  padding:20px;
  background:rgba(0,0,0,0.65);
  backdrop-filter:blur(4px);
  z-index:2000;
}
.ranking-modal.is-open { display:flex; }
.ranking-modal__dialog {
  width:100%;
  max-width:400px;
  max-height:80vh;
  overflow:hidden;
  background:rgba(0,0,0,0.9);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:18px;
  box-shadow:0 20px 50px rgba(0,0,0,0.35);
  display:flex;
  flex-direction:column;
}
.ranking-modal__header {
  padding:14px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  border-bottom:1px solid rgba(255,255,255,0.12);
}
.ranking-modal__title { margin:0; font-size:16px; }
.ranking-modal__close {
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.2);
  color:#fff;
  padding:6px 10px;
  border-radius:10px;
  cursor:pointer;
}
.ranking-modal__body {
  padding:16px;
  overflow:auto;
  max-height:70vh;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.ranking-button {
  width:100%;
  max-width:360px;
}
.rank-list {
  max-height:60vh;
  overflow:auto;
  scrollbar-width:thin;
}
.switch {
  position:relative;
  display:inline-block;
  width:48px;
  height:26px;
}
.switch input { opacity:0; width:0; height:0; }
.slider {
  position:absolute;
  inset:0;
  background:#4b5563;
  border-radius:20px;
  transition:0.2s;
}
.slider:before {
  content:"";
  position:absolute;
  height:20px;
  width:20px;
  left:3px;
  top:3px;
  background:#fff;
  border-radius:50%;
  transition:0.2s;
}
.switch input:checked + .slider { background:#22c55e; }
.switch input:checked + .slider:before { transform:translateX(22px); }
.volume-label {
  font-size:14px;
  color:#ccc;
}
.back-link {
  position:absolute;
  top:16px;
  left:16px;
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.35);
  background:rgba(0,0,0,0.65);
  color:#fff;
  font:600 13px/1.2 system-ui;
  text-decoration:none;
  transition:background 0.2s ease,color 0.2s ease,transform 0.2s ease;
}
.back-link:hover,
.back-link:focus-visible {
  background:#fff;
  color:#000;
  transform:translateY(-1px);
  outline:none;
}
.developer-credit {
  font-size:14px;
  color:#9ca3af;
  margin:0 0 12px;
}
.developer-credit a {
  color:#1DA1F2;
  text-decoration:none;
}
.developer-credit a:hover,
.developer-credit a:focus-visible {
  text-decoration:underline;
}
.ad-footer{
  width:100%;
  max-width:360px;
  padding:0 0 calc(12px + env(safe-area-inset-bottom, 0px));
  box-sizing:border-box;
  display:flex;
  justify-content:center;
  background:#000;
  border-top:1px solid rgba(255,255,255,0.08);
}
.ad-footer ins{
  display:block;
  width:320px;
  max-width:320px;
  height:40px;
  overflow:hidden;
}
.control-bar-wrapper {
  width:100%;
  max-width:360px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:16px;
  padding:0 16px;
  box-sizing:border-box;
}
</style>
<link href="../character-dots/mao1.png" rel="icon" type="image/png"/>  <style id="ads-safe">
    html, body {
      max-width: 100vw;
      overflow-x: hidden;
    }
    .adsbygoogle,
    ins.adsbygoogle {
      display: block !important;
      width: 100% !important;
      max-width: 100% !important;
      min-width: 0 !important;
      box-sizing: border-box;
      overflow: hidden;
    }
    .adsbygoogle iframe,
    ins.adsbygoogle iframe {
      display: block;
      width: 100% !important;
      max-width: 100% !important;
      min-width: 0 !important;
    }
  </style>
  <style id="interaction-guard">
    * {
      -webkit-touch-callout: none;
      -webkit-user-drag: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    input,
    textarea,
    [contenteditable] {
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
  <script id="interaction-guard-js">
    document.addEventListener('contextmenu', (event) => {
      event.preventDefault();
    });
    document.addEventListener('dragstart', (event) => {
      event.preventDefault();
    });
  </script>
  <script id="ads-lazy">
    (function() {
      if (window.pixieedObserveAds) return;
      const pending = [];
      const hasObserverSupport = 'IntersectionObserver' in window;
      let observer = null;
      const isLoaded = (ins) => (
        ins.dataset.adsLazyLoaded === '1' ||
        ins.getAttribute('data-adsbygoogle-status') === 'done' ||
        ins.getAttribute('data-ad-status') === 'filled'
      );
      const loadAd = (ins) => {
        if (!ins || !(ins instanceof HTMLElement)) return;
        if (isLoaded(ins)) return;
        ins.dataset.adsLazyLoaded = '1';
        try {
          (window.adsbygoogle = window.adsbygoogle || []).push({});
        } catch (err) {
          ins.dataset.adsLazyLoaded = '';
        }
      };
      const observeAd = (ins) => {
        if (!ins || !(ins instanceof HTMLElement)) return;
        if (ins.dataset.adsLazyObserved === '1') return;
        if (isLoaded(ins)) return;
        ins.dataset.adsLazyObserved = '1';
        if (!observer) {
          if (!hasObserverSupport) {
            loadAd(ins);
          } else {
            pending.push(ins);
          }
          return;
        }
        observer.observe(ins);
      };
      const observeAds = (root) => {
        const scope = root && root.querySelectorAll ? root : document;
        scope.querySelectorAll('ins.adsbygoogle').forEach(observeAd);
      };
      window.pixieedObserveAds = observeAds;
      const setupObserver = () => {
        if (hasObserverSupport) {
          observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting || entry.intersectionRatio > 0) {
                const target = entry.target;
                if (observer) observer.unobserve(target);
                loadAd(target);
              }
            });
          }, { rootMargin: '200px 0px', threshold: 0.01 });
        }
        const queued = pending.splice(0);
        queued.forEach((ins) => {
          if (observer) {
            observer.observe(ins);
          } else {
            loadAd(ins);
          }
        });
        observeAds(document);
      };
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupObserver);
      } else {
        setupObserver();
      }
      const mo = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (!(node instanceof HTMLElement)) return;
            if (node.matches && node.matches('ins.adsbygoogle')) {
              observeAd(node);
              return;
            }
            if (node.querySelectorAll) {
              node.querySelectorAll('ins.adsbygoogle').forEach(observeAd);
            }
          });
        });
      });
      const startObserver = () => {
        if (!document.body) return;
        mo.observe(document.body, { childList: true, subtree: true });
      };
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', startObserver);
      } else {
        startObserver();
      }
    })();
  </script>
</head>
<body>
<h1>魔王様！！いつまでよければいいですか！？</h1>
<p class="developer-credit">開発者: <a href="https://x.com/PiXiEED_arta" rel="noopener" target="_blank">@PiXiEED_arta</a></p>
<div class="start-content">
<div class="instructions-card">
<h2>遊び方</h2>
<ul>
<li>操作：画面をタップ / マウスドラッグ、または ←→ キーで移動します。</li>
<li>敵にぶつかると即ゲームオーバーです。</li>
<li>エンジェリンを取ると一度だけ身代わりが発動し、次の衝突を防ぎます。</li>
</ul>
</div>
<div aria-label="ゲーム操作" class="control-bar-wrapper" role="region">
<div class="control-bar__audio">
<label class="switch">
<input id="audioToggle" type="checkbox"/>
<span class="slider"></span>
</label>
<span class="volume-label" id="audioToggleLabel"></span>
</div>
<div class="difficulty-toggle" id="difficultyToggle">
<button class="difficulty-btn" data-mode="easy" type="button">簡単</button>
<button class="difficulty-btn" data-mode="normal" type="button">普通</button>
<button class="difficulty-btn is-active" data-mode="endless" type="button">無限</button>
</div>
<div class="control-bar">
<button class="control-bar__btn control-bar__btn--primary" id="playBtn">▶ プレイ</button>
<button class="control-bar__btn control-bar__btn--secondary" id="titleShareBtn">シェアする</button>
<button class="control-bar__btn control-bar__btn--secondary" id="openRankingBtn">ランキング</button>
</div>
</div>
</div>
<div class="ranking-modal" id="rankingModal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="ranking-modal__dialog">
    <div class="ranking-modal__header">
      <h3 class="ranking-modal__title">ランキング</h3>
      <button class="ranking-modal__close" id="closeRankingBtn" type="button">閉じる</button>
    </div>
    <div class="ranking-modal__body">
      <form class="rank-form" id="rankForm">
        <label class="rank-field">
          <span>名前</span>
          <div class="rank-name-display" id="rankNameDisplay">未設定</div>
        </label>
        <p class="rank-status" id="rankStatus"></p>
      </form>
      <ol class="rank-list" id="rankList"></ol>
    </div>
  </div>
</div>
<div class="ad-footer">
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9801602250480253"
     data-ad-slot="2141591954"></ins>
</div>
<script>
// Prevent pinch-zoom on iOS to keep the layout stable.
['gesturestart', 'gesturechange', 'gestureend'].forEach((eventName) => {
  document.addEventListener(eventName, (event) => {
    event.preventDefault();
  }, { passive: false });
});

document.addEventListener('touchmove', (event) => {
  if(event.touches.length > 1){
    event.preventDefault();
  }
}, { passive: false });

const GAME_URL = './game.html';
const AUDIO_KEY = 'maoitu_audio';
const DIFFICULTY_KEY = 'maoitu_difficulty';
const GAME_CANONICAL_URL = `${window.location.origin}/maoitu/`;
const playBtn = document.getElementById('playBtn');
const shareBtn = document.getElementById('titleShareBtn');
const openRankingBtn = document.getElementById('openRankingBtn');
const audioToggle = document.getElementById('audioToggle');
const audioToggleLabel = document.getElementById('audioToggleLabel');
const difficultyToggle = document.getElementById('difficultyToggle');
const difficultyButtons = Array.from(difficultyToggle.querySelectorAll('.difficulty-btn'));
const rankingModal = document.getElementById('rankingModal');
const closeRankingBtn = document.getElementById('closeRankingBtn');
let selectedDifficulty = 'endless';

function baseShareText(){
  return `開発者:@PiXiEED_arta\n『魔王様！！いつまでよければいいですか！？』\n皆もやってみてね！！！\n\nリンクから遊べるよ！！#PiXiEED\n\n${GAME_CANONICAL_URL}`;
}

shareBtn.addEventListener('click', async () => {
  try{
    await navigator.clipboard.writeText(baseShareText());
    alert('シェア用テキストをコピーしました！');
  }catch(err){
    alert('クリップボードへのコピーに失敗しました。手動で共有してください。');
  }
});

playBtn.addEventListener('click', () => {
  const url = `${GAME_URL}?mode=${encodeURIComponent(selectedDifficulty)}`;
  window.location.href = url;
});

function openRanking(){
  if(!rankingModal) return;
  rankingModal.classList.add('is-open');
  rankingModal.setAttribute('aria-hidden', 'false');
  if(window.__rankingController && typeof window.__rankingController.refresh === 'function'){
    window.__rankingController.refresh();
  }
}
function closeRanking(){
  if(!rankingModal) return;
  rankingModal.classList.remove('is-open');
  rankingModal.setAttribute('aria-hidden', 'true');
}
if(openRankingBtn){
  openRankingBtn.addEventListener('click', openRanking);
}
if(closeRankingBtn){
  closeRankingBtn.addEventListener('click', closeRanking);
}
if(rankingModal){
  rankingModal.addEventListener('click', (e) => {
    if(e.target === rankingModal){
      closeRanking();
    }
  });
}

function updateAudioLabel(){
  audioToggleLabel.textContent = audioToggle.checked ? '音量 ON' : '音量 OFF';
}

const storedAudio = localStorage.getItem(AUDIO_KEY);
audioToggle.checked = storedAudio !== 'off';
updateAudioLabel();

audioToggle.addEventListener('change', () => {
  localStorage.setItem(AUDIO_KEY, audioToggle.checked ? 'on' : 'off');
  updateAudioLabel();
});
function updateDifficultyButtons(){
  difficultyButtons.forEach(btn=>{
    btn.classList.toggle('is-active', btn.dataset.mode === selectedDifficulty);
  });
}
const storedDifficulty = localStorage.getItem(DIFFICULTY_KEY);
if(storedDifficulty === 'easy' || storedDifficulty === 'normal' || storedDifficulty === 'endless'){
  selectedDifficulty = storedDifficulty;
}
updateDifficultyButtons();
difficultyButtons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const mode = btn.dataset.mode;
    if(mode === 'easy' || mode === 'normal' || mode === 'endless'){
      selectedDifficulty = mode;
      localStorage.setItem(DIFFICULTY_KEY, mode);
      updateDifficultyButtons();
    }
  });
});
if (window.pixieedObserveAds) {
  window.pixieedObserveAds();
}

</script>
<script type="module">
import { initRankingUI } from './assets/js/ranking.js';
initRankingUI({
  formSelector: '#rankForm',
  listSelector: '#rankList',
  statusSelector: '#rankStatus'
}).then(ctrl => {
  window.__rankingController = ctrl;
});
</script>
</body>
</html>
