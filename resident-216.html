<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>常駐ルーム 256x256 — PiXiEED</title>
  <style>
    :root {
      --bg: #0b1224;
      --card: rgba(255, 255, 255, 0.06);
      --line: rgba(255, 255, 255, 0.14);
      --text: #f8fafc;
      --muted: #cbd5e1;
      --accent: #58c4ff;
      --warn: #fbbf24;
      --swatch-size: 28px;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Hiragino Sans", "Noto Sans JP", "Yu Gothic", sans-serif;
      background: radial-gradient(1200px 600px at 30% -10%, #1d2d58 0%, var(--bg) 55%);
      color: var(--text);
    }
    .wrap {
      max-width: 1080px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      display: grid;
      gap: 16px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 14px;
      backdrop-filter: blur(6px);
    }
    .head {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .title {
      margin: 0;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.03em;
    }
    .description {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 14px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 12px;
      color: var(--muted);
      background: rgba(2, 6, 23, 0.45);
      text-decoration: none;
    }
    button.chip {
      font: inherit;
      cursor: pointer;
    }
    .chip--role {
      border-color: rgba(88, 196, 255, 0.6);
      color: #dff4ff;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    .palette {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }
    .swatch {
      width: var(--swatch-size);
      height: var(--swatch-size);
      border-radius: 7px;
      border: 2px solid transparent;
      cursor: pointer;
      background: #fff;
    }
    .swatch.is-active {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(88, 196, 255, 0.22);
    }
    .select {
      border-radius: 8px;
      border: 1px solid var(--line);
      background: rgba(15, 23, 42, 0.8);
      color: var(--text);
      padding: 6px 10px;
    }
    .select--color {
      width: 44px;
      height: 32px;
      padding: 3px;
      border-radius: 8px;
      cursor: pointer;
    }
    .palette-zoom {
      width: 120px;
      accent-color: var(--accent);
    }
    .canvas-shell {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #000;
      width: min(92vw, 640px);
      aspect-ratio: 1 / 1;
      position: relative;
      overflow: hidden;
      margin-top: 12px;
    }
    canvas {
      width: 100%;
      height: 100%;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      display: block;
      position: absolute;
      inset: 0;
    }
    #roomOverlay {
      pointer-events: none;
    }
    #roomCanvas.is-readonly {
      cursor: not-allowed;
      filter: saturate(0.75);
    }
    .meta {
      display: grid;
      gap: 6px;
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
    }
    .meta strong {
      color: #fff;
      font-weight: 700;
    }
    .roster {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    .roster h2 {
      margin: 0 0 8px;
      font-size: 14px;
      color: #e2e8f0;
    }
    .roster ol {
      margin: 0;
      padding-left: 18px;
      min-height: 80px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }
    .help {
      margin-top: 6px;
      color: var(--warn);
      font-size: 12px;
    }
    @media (max-width: 760px) {
      .roster { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <div class="head">
        <div>
          <h1 class="title" id="roomTitle">常駐ルーム 256x256</h1>
          <p class="description" id="roomDescription"></p>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <span class="chip chip--role" id="roleBadge">接続中</span>
          <a class="chip" href="index.html">ホームへ戻る</a>
        </div>
      </div>
      <div class="controls">
        <div class="palette" id="palette" aria-label="パレット"></div>
        <label>ブラシ
          <select class="select" id="brushSize" aria-label="ブラシサイズ"></select>
        </label>
        <label>色編集
          <input class="select select--color" id="customColorPicker" type="color" value="#ffffff" aria-label="色編集"/>
        </label>
        <button class="chip" id="addCustomColor" type="button">パレットに追加</button>
        <label>パレット倍率
          <input class="palette-zoom" id="paletteZoom" type="range" min="80" max="220" step="10" value="100" aria-label="パレット倍率"/>
        </label>
      </div>
      <div class="canvas-shell">
        <canvas id="roomCanvas" width="256" height="256" aria-label="常駐ルームキャンバス"></canvas>
        <canvas id="roomOverlay" width="256" height="256" aria-hidden="true"></canvas>
      </div>
      <div class="meta">
        <div>接続状態: <strong id="status">接続中…</strong></div>
        <div>ルームキー: <strong id="roomKey">resident-256-main</strong></div>
        <div>参加者: <strong id="activeCount">0</strong> / <strong id="maxCount">10</strong> ・ 待機: <strong id="queueCount">0</strong></div>
        <div id="cellInfo"></div>
      </div>
      <p class="help">仕様: 管理権限なし。参加上限10人。色編集・パレット倍率は各自ローカル。11人目以降は待機キューに入り、空きが出ると入室順で自動参加します。</p>
    </section>

    <section class="card roster">
      <div>
        <h2>参加中</h2>
        <ol id="activeList"></ol>
      </div>
      <div>
        <h2>待機キュー</h2>
        <ol id="queueList"></ol>
      </div>
    </section>
  </main>
  <script type="module" src="resident-216.js"></script>
</body>
</html>
